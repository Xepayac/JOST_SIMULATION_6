{% extends 'layout.html' %}

{% block content %}
    <h1>Run Simulation: {{ simulation.title }}</h1>

    <form action="{{ url_for('run_simulation_page', simulation_id=simulation.id) }}" method="post">
        <input type="hidden" name="title" value="{{ simulation.title }}">

        <div style="display: flex; align-items: center; margin-bottom: 1rem; border: 1px solid #ccc; padding: 1rem; border-radius: 4px;">
            <div id="player-info" style="flex-grow: 1;">
                {% if simulation.player %}
                    <div><strong>Player:</strong> {{ simulation.player.name }}</div>
                    <div><strong>Bankroll:</strong> {{ simulation.player.bankroll }}</div>
                {% else %}
                    <div style="color: red;">No player selected. Please choose a player.</div>
                {% endif %}
            </div>
            <a href="{{ url_for('players', simulation_id=simulation.id) }}" class="button">
                {% if simulation.player %}Change Player{% else %}Choose Player{% endif %}
            </a>
        </div>

        <div style="display: flex; align-items: center; margin-bottom: 1rem; border: 1px solid #ccc; padding: 1rem; border-radius: 4px;">
            <div id="casino-info" style="flex-grow: 1;">
                {% if simulation.casino %}
                    <div><strong>Casino:</strong> {{ simulation.casino.name }}</div>
                {% else %}
                    <div style="color: red;">No casino selected. Please choose a casino.</div>
                {% endif %}
            </div>
            <a href="{{ url_for('casinos', simulation_id=simulation.id) }}" class="button">
                {% if simulation.casino %}Change Casino{% else %}Choose Casino{% endif %}
            </a>
        </div>

        <div style="display: flex; align-items: center; margin-bottom: 1rem; border: 1px solid #ccc; padding: 1rem; border-radius: 4px;">
            <div id="strategy-info" style="flex-grow: 1;">
                {% if simulation.strategy %}
                    <div><strong>Strategy:</strong> {{ simulation.strategy }}</div>
                {% else %}
                    <div style="color: red;">No strategy selected. Please choose a strategy.</div>
                {% endif %}
            </div>
            <a href="{{ url_for('strategies', simulation_id=simulation.id) }}" class="button">
                {% if simulation.strategy %}Change Strategy{% else %}Choose Strategy{% endif %}
            </a>
        </div>

        <div style="display: flex; align-items: center; margin-bottom: 1rem; border: 1px solid #ccc; padding: 1rem; border-radius: 4px;">
            <div id="betting-strategy-info" style="flex-grow: 1;">
                {% if simulation.betting_strategy %}
                    <div><strong>Betting Strategy:</strong> {{ simulation.betting_strategy.name }}</div>
                {% else %}
                    <div style="color: red;">No betting strategy selected. Please choose a betting strategy.</div>
                {% endif %}
            </div>
            <a href="{{ url_for('betting_strategies_selection', simulation_id=simulation.id) }}" class="button">
                {% if simulation.betting_strategy %}Change Betting Strategy{% else %}Choose Betting Strategy{% endif %}
            </a>
        </div>

        <label for="iterations">Iterations:</label><br>
        <input type="number" id="iterations" name="iterations" value="{{ simulation.iterations if simulation else 100 }}" style="width: 100%; margin-bottom: 1rem;"><br>

        <label for="notes">Notes:</label><br>
        <textarea id="notes" name="notes" rows="4" style="width: 100%; margin-bottom: 1rem;">{{ simulation.notes if simulation else '' }}</textarea><br>

        <div style="display: flex; justify-content: space-between;">
            <button type="submit" formaction="{{ url_for('run_simulation_page', simulation_id=simulation.id) }}">Save</button>
            <button type="submit" formaction="{{ url_for('run_simulation_action', simulation_id=simulation.id) }}">Run Simulation</button>
        </div>
    </form>
{% endblock %}
