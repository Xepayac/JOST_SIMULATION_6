{% extends "layout.html" %}

{% block title %}
Run Simulation: {{ simulation.title }}
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="my-4">Run Simulation: <small>{{ simulation.title }}</small></h1>

    <form action="{{ url_for('main.run_simulation_action', simulation_id=simulation.id) }}" method="POST">
        <div class="row">
            <!-- Column for Player, Casino, Strategies -->
            <div class="col-md-6">
                <!-- Player Selection -->
                <div class="form-group">
                    <label for="player_id"><h4><i class="fas fa-user"></i> Player</h4></label>
                    <select class="form-control" id="player_id" name="player_id">
                        {% for player in players %}
                        <option value="{{ player.id }}" {% if simulation.player_id == player.id %}selected{% endif %}>
                            {{ player.name }} (Bankroll: ${{ player.bankroll }})
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Casino Selection -->
                <div class="form-group">
                    <label for="casino_id"><h4><i class="fas fa-building"></i> Casino</h4></label>
                    <select class="form-control" id="casino_id" name="casino_id">
                        {% for casino in casinos %}
                        <option value="{{ casino.id }}" {% if simulation.casino_id == casino.id %}selected{% endif %}>
                            {{ casino.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Playing Strategy Selection (Corrected) -->
                <div class="form-group">
                    <label for="playing_strategy_id"><h4><i class="fas fa-brain"></i> Playing Strategy</h4></label>
                    <select class="form-control" id="playing_strategy_id" name="playing_strategy_id">
                        {% for playing_strategy in playing_strategies %}
                        <option value="{{ playing_strategy.id }}" {% if simulation.playing_strategy_id == playing_strategy.id %}selected{% endif %}>
                            {{ playing_strategy.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Betting Strategy Selection -->
                <div class="form-group">
                    <label for="betting_strategy_id"><h4><i class="fas fa-dollar-sign"></i> Betting Strategy</h4></label>
                    <select class="form-control" id="betting_strategy_id" name="betting_strategy_id">
                        {% for bet_strat in betting_strategies %}
                        <option value="{{ bet_strat.id }}" {% if simulation.betting_strategy_id == bet_strat.id %}selected{% endif %}>
                            {{ bet_strat.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Column for Iterations and Notes -->
            <div class="col-md-6">
                <!-- Iterations -->
                <div class="form-group">
                    <label for="iterations"><h4><i class="fas fa-redo"></i> Iterations (Hands to Play)</h4></label>
                    <input type="number" class="form-control" id="iterations" name="iterations" value="{{ simulation.iterations or 1000000 }}" min="1">
                </div>

                <!-- True Count Threshold (Note: This is not currently wired up in the refactored backend) -->
                <div class="form-group">
                    <label for="true_count_threshold"><h4><i class="fas fa-chart-line"></i> True Count Threshold</h4></label>
                    <input type="number" class="form-control" id="true_count_threshold" name="true_count_threshold" value="1" min="0">
                    <small class="form-text text-muted">Note: This is not currently used by the simulation engine.</small>
                </div>

                <!-- Notes -->
                <div class="form-group">
                    <label for="notes"><h4><i class="fas fa-clipboard"></i> Notes</h4></label>
                    <textarea class="form-control" id="notes" name="notes" rows="8">{{ simulation.notes or '' }}</textarea>
                </div>
                
                <!-- Hand History Checkbox -->
                <div class="form-check mt-3">
                    <input class="form-check-input" type="checkbox" value="true" id="log_hands" name="log_hands">
                    <label class="form-check-label" for="log_hands">
                        <h5><i class="fas fa-history"></i> Record Hand-by-Hand History</h5>
                        <small class="text-warning">Warning: This will significantly slow down the simulation.</small>
                    </label>
                </div>

            </div>
        </div>

        <!-- Run Button -->
        <div class="mt-4">
            <button type="submit" class="btn btn-primary btn-lg btn-block"><i class="fas fa-play"></i> Run Simulation</button>
        </div>
    </form>
</div>
{% endblock %}
